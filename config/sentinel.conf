# Redis Sentinel Configuration Template (NEM-3413)
#
# This configuration file is used by Redis Sentinel instances for high availability.
# Copy this file to each Sentinel node and update the bind address as needed.
#
# For production deployments, deploy at least 3 Sentinel instances across different
# physical machines or availability zones to ensure quorum can be maintained.
#
# Environment variables (set in docker-compose or .env):
#   - SENTINEL_QUORUM: Minimum Sentinels to agree on failover (default: 2)
#   - REDIS_MASTER_HOST: Redis master hostname (default: redis)
#   - REDIS_MASTER_PORT: Redis master port (default: 6379)
#   - REDIS_PASSWORD: Redis authentication password (optional)  # pragma: allowlist secret

# Sentinel port (standard: 26379)
port 26379

# Bind to all interfaces (use specific IP in production)
bind 0.0.0.0

# Sentinel working directory
dir /data

# Sentinel log file (empty for stdout, useful for Docker logging)
logfile ""

# Monitor the Redis master
# Format: sentinel monitor <master-name> <ip> <port> <quorum>
# The quorum is the number of Sentinels that need to agree the master is unreachable
# to trigger a failover. Recommend: (N/2)+1 where N is total Sentinel count.
# With 3 Sentinels, quorum=2 means 2 must agree for failover.
sentinel monitor mymaster redis 6379 2

# Password authentication for Redis master and replicas
# Uncomment and set if REDIS_PASSWORD is configured
# sentinel auth-pass mymaster <password>

# Time in milliseconds after which a master is considered down if not reachable
# Lower values = faster failover detection, but may cause false positives
# Recommended: 5000-10000ms for production, 1000ms for development
sentinel down-after-milliseconds mymaster 5000

# Timeout for the failover process itself
# After this time, the failover is considered failed
sentinel failover-timeout mymaster 60000

# Maximum number of replicas that can be reconfigured simultaneously during failover
# Higher values = faster failover, but more load on master
# Set to 1 for minimal impact during failover
sentinel parallel-syncs mymaster 1

# Notification script (optional)
# Called when Sentinel detects state changes
# sentinel notification-script mymaster /scripts/notify.sh

# Client reconfiguration script (optional)
# Called when clients should be reconfigured after failover
# sentinel client-reconfig-script mymaster /scripts/reconfig.sh

# Deny scripts rewrite
# Security setting to prevent scripts from being rewritten
sentinel deny-scripts-reconfig yes

# Announce IP and port for NAT/Docker environments (optional)
# Uncomment and configure if Sentinels are behind NAT or in Docker
# sentinel announce-ip <ip>
# sentinel announce-port 26379

# Resolve hostnames (Redis 6.2+)
# Enable hostname resolution for replica discovery in Docker/Kubernetes
sentinel resolve-hostnames yes

# Hostname announces (Redis 6.2+)
# Announce hostnames instead of IPs (useful for Docker/Kubernetes service discovery)
sentinel announce-hostnames yes
