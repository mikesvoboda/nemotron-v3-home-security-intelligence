"""Core infrastructure components."""

from backend.core.config import Settings, get_settings

# Nested settings with env_nested_delimiter (NEM-3778)
from backend.core.config_nested import (
    AIServiceSettings,
    DatabaseSettings,
    DetectorSettings,
    LLMSettings,
    NestedSettings,
    NotificationSettings,
    RedisPoolSettings,
    RedisSettings,
    RedisSSLSettings,
    SMTPSettings,
    WebhookSettings,
    get_nested_settings,
)
from backend.core.config_validation import (
    ConfigValidationResult,
    ValidationItem,
    log_config_summary,
    validate_config,
)
from backend.core.container import (
    CircularDependencyError,
    Container,
    ServiceAlreadyRegisteredError,
    ServiceNotFoundError,
    get_container,
    reset_container,
    wire_services,
)
from backend.core.database import (
    Base,
    close_db,
    escape_ilike_pattern,
    get_db,
    get_engine,
    get_pool_status,
    get_session,
    get_session_factory,
    init_db,
    with_session,
)
from backend.core.executors import (
    HAS_INTERPRETER_POOL,
    get_cpu_executor,
    get_executor_info,
    get_executor_type,
    is_free_threaded,
)
from backend.core.free_threading import (
    FreeThreadingStatus,
    check_free_threading_support,
    get_threading_mode,
    verify_free_threading,
)
from backend.core.json_utils import (
    extract_json_field,
    extract_json_from_llm_response,
    safe_json_loads,
)
from backend.core.logging import (
    SENSITIVE_FIELD_NAMES,
    get_log_context,
    get_logger,
    get_request_id,
    log_context,
    log_exception_with_context,
    redact_sensitive_value,
    redact_url,
    sanitize_error,
    set_request_id,
    setup_logging,
)
from backend.core.metrics import (
    get_metrics_response,
    observe_ai_request_duration,
    observe_ai_request_with_exemplar,
    observe_florence_inference,
    observe_florence_with_exemplar,
    observe_nemotron_inference,
    observe_nemotron_with_exemplar,
    observe_yolo26_inference,
    observe_yolo26_with_exemplar,
    observe_stage_duration,
    observe_with_exemplar,
    record_detection_processed,
    record_event_created,
    record_pipeline_error,
    set_queue_depth,
)
from backend.core.mime_types import (
    DEFAULT_IMAGE_MIME,
    DEFAULT_VIDEO_MIME,
    EXTENSION_TO_MIME,
    get_mime_type,
    get_mime_type_with_default,
    is_image_mime_type,
    is_supported_mime_type,
    is_video_mime_type,
    normalize_file_type,
)
from backend.core.profiling import (
    ProfilingManager,
    get_profiling_manager,
    profile_if_enabled,
    reset_profiling_manager,
)
from backend.core.protocols import (
    AIServiceProtocol,
    AIServiceWithLifecycle,
    BroadcasterProtocol,
    BroadcasterWithMetrics,
    CacheProtocol,
    HealthCheckableProtocol,
    InputT,
    LifecycleProtocol,
    MetricsProviderProtocol,
    ModelLoaderProtocol,
    OutputT,
    QueueProcessorProtocol,
    SubscribableProtocol,
)
from backend.core.query_explain import (
    QueryExplainLogger,
    setup_explain_logging,
)
from backend.core.redis import (
    QueueAddResult,
    RedisClient,
    close_redis,
    get_redis,
    get_redis_client_sync,
    get_redis_optional,
    init_redis,
)
from backend.core.tls import (
    CertificateNotFoundError,
    CertificateValidationError,
    TLSConfig,
    TLSConfigurationError,
    TLSError,
    TLSMode,
    create_ssl_context,
    generate_self_signed_cert,
    generate_self_signed_certificate,
    get_cert_info,
    get_tls_config,
    is_tls_enabled,
    load_certificate_paths,
    validate_certificate,
    validate_certificate_files,
)

__all__ = [
    # Constants
    "DEFAULT_IMAGE_MIME",
    "DEFAULT_VIDEO_MIME",
    "EXTENSION_TO_MIME",
    "HAS_INTERPRETER_POOL",
    "SENSITIVE_FIELD_NAMES",
    # Protocols
    "AIServiceProtocol",
    # Nested Settings classes (NEM-3778)
    "AIServiceSettings",
    "AIServiceWithLifecycle",
    # Classes
    "Base",
    "BroadcasterProtocol",
    "BroadcasterWithMetrics",
    "CacheProtocol",
    "CertificateNotFoundError",
    "CertificateValidationError",
    "CircularDependencyError",
    "ConfigValidationResult",
    "Container",
    "DatabaseSettings",
    "DetectorSettings",
    "FreeThreadingStatus",
    "HealthCheckableProtocol",
    "InputT",
    "LLMSettings",
    "LifecycleProtocol",
    "MetricsProviderProtocol",
    "ModelLoaderProtocol",
    "NestedSettings",
    "NotificationSettings",
    "OutputT",
    "ProfilingManager",
    "QueryExplainLogger",
    "QueueAddResult",
    "QueueProcessorProtocol",
    "RedisClient",
    "RedisPoolSettings",
    "RedisSSLSettings",
    "RedisSettings",
    "SMTPSettings",
    "ServiceAlreadyRegisteredError",
    "ServiceNotFoundError",
    "Settings",
    "SubscribableProtocol",
    "TLSConfig",
    "TLSConfigurationError",
    "TLSError",
    "TLSMode",
    "ValidationItem",
    "WebhookSettings",
    "check_free_threading_support",
    # Functions
    "close_db",
    "close_redis",
    "create_ssl_context",
    "escape_ilike_pattern",
    "extract_json_field",
    "extract_json_from_llm_response",
    "generate_self_signed_cert",
    "generate_self_signed_certificate",
    "get_cert_info",
    "get_container",
    "get_cpu_executor",
    "get_db",
    "get_engine",
    "get_executor_info",
    "get_executor_type",
    "get_log_context",
    "get_logger",
    "get_metrics_response",
    "get_mime_type",
    "get_mime_type_with_default",
    "get_nested_settings",
    "get_pool_status",
    "get_profiling_manager",
    "get_redis",
    "get_redis_client_sync",
    "get_redis_optional",
    "get_request_id",
    "get_session",
    "get_session_factory",
    "get_settings",
    "get_threading_mode",
    "get_tls_config",
    "init_db",
    "init_redis",
    "is_free_threaded",
    "is_image_mime_type",
    "is_supported_mime_type",
    "is_tls_enabled",
    "is_video_mime_type",
    "load_certificate_paths",
    "log_config_summary",
    "log_context",
    "log_exception_with_context",
    "normalize_file_type",
    "observe_ai_request_duration",
    "observe_ai_request_with_exemplar",
    "observe_florence_inference",
    "observe_florence_with_exemplar",
    "observe_nemotron_inference",
    "observe_nemotron_with_exemplar",
    "observe_yolo26_inference",
    "observe_yolo26_with_exemplar",
    "observe_stage_duration",
    "observe_with_exemplar",
    "profile_if_enabled",
    "record_detection_processed",
    "record_event_created",
    "record_pipeline_error",
    "redact_sensitive_value",
    "redact_url",
    "reset_container",
    "reset_profiling_manager",
    "safe_json_loads",
    "sanitize_error",
    "set_queue_depth",
    "set_request_id",
    "setup_explain_logging",
    "setup_logging",
    "validate_certificate",
    "validate_certificate_files",
    "validate_config",
    "verify_free_threading",
    "wire_services",
    "with_session",
]
