<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 600" fill="none">
  <defs>
    <!-- Gradients -->
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#1a1a2e"/>
      <stop offset="100%" stop-color="#16213e"/>
    </linearGradient>
    <linearGradient id="clientGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#3B82F6"/>
      <stop offset="100%" stop-color="#2563EB"/>
    </linearGradient>
    <linearGradient id="wsGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#10B981"/>
      <stop offset="100%" stop-color="#059669"/>
    </linearGradient>
    <linearGradient id="broadcasterGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#F59E0B"/>
      <stop offset="100%" stop-color="#D97706"/>
    </linearGradient>
    <linearGradient id="redisGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#EF4444"/>
      <stop offset="100%" stop-color="#DC2626"/>
    </linearGradient>
    <linearGradient id="analyzerGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#8B5CF6"/>
      <stop offset="100%" stop-color="#7C3AED"/>
    </linearGradient>
    <!-- Drop shadow filter -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <!-- Arrow markers -->
    <marker id="arrowRight" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#60A5FA"/>
    </marker>
    <marker id="arrowLeft" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
      <polygon points="10 0, 0 3.5, 10 7" fill="#60A5FA"/>
    </marker>
    <marker id="arrowRightDashed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34D399"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="850" height="600" fill="url(#bgGrad)"/>

  <!-- Title -->
  <text x="425" y="35" fill="#E5E7EB" font-family="system-ui, -apple-system, sans-serif" font-size="20" font-weight="600" text-anchor="middle">Events Channel Sequence</text>

  <!-- Participant headers -->
  <g transform="translate(0, 55)">
    <!-- Browser -->
    <g transform="translate(80, 0)" filter="url(#shadow)">
      <rect x="0" y="0" width="100" height="40" rx="6" fill="url(#clientGrad)"/>
      <text x="50" y="25" fill="white" font-family="system-ui, sans-serif" font-size="12" font-weight="500" text-anchor="middle">Browser</text>
    </g>

    <!-- /ws/events -->
    <g transform="translate(230, 0)" filter="url(#shadow)">
      <rect x="0" y="0" width="100" height="40" rx="6" fill="url(#wsGrad)"/>
      <text x="50" y="25" fill="white" font-family="monospace" font-size="11" font-weight="500" text-anchor="middle">/ws/events</text>
    </g>

    <!-- EventBroadcaster -->
    <g transform="translate(380, 0)" filter="url(#shadow)">
      <rect x="0" y="0" width="130" height="40" rx="6" fill="url(#broadcasterGrad)"/>
      <text x="65" y="25" fill="white" font-family="system-ui, sans-serif" font-size="11" font-weight="500" text-anchor="middle">EventBroadcaster</text>
    </g>

    <!-- Redis Pub/Sub -->
    <g transform="translate(560, 0)" filter="url(#shadow)">
      <rect x="0" y="0" width="110" height="40" rx="6" fill="url(#redisGrad)"/>
      <text x="55" y="25" fill="white" font-family="system-ui, sans-serif" font-size="11" font-weight="500" text-anchor="middle">Redis Pub/Sub</text>
    </g>

    <!-- NemotronAnalyzer -->
    <g transform="translate(720, 0)" filter="url(#shadow)">
      <rect x="0" y="0" width="100" height="40" rx="6" fill="url(#analyzerGrad)"/>
      <text x="50" y="17" fill="white" font-family="system-ui, sans-serif" font-size="10" font-weight="500" text-anchor="middle">Nemotron</text>
      <text x="50" y="32" fill="white" font-family="system-ui, sans-serif" font-size="10" font-weight="500" text-anchor="middle">Analyzer</text>
    </g>
  </g>

  <!-- Lifelines -->
  <g stroke="#4B5563" stroke-width="1" stroke-dasharray="4,4">
    <line x1="130" y1="100" x2="130" y2="560"/>
    <line x1="280" y1="100" x2="280" y2="560"/>
    <line x1="445" y1="100" x2="445" y2="560"/>
    <line x1="615" y1="100" x2="615" y2="560"/>
    <line x1="770" y1="100" x2="770" y2="560"/>
  </g>

  <!-- Connection Phase -->
  <g transform="translate(0, 120)">
    <!-- Connect (upgrade) -->
    <line x1="130" y1="0" x2="270" y2="0" stroke="#60A5FA" stroke-width="2" marker-end="url(#arrowRight)"/>
    <text x="200" y="-8" fill="#93C5FD" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">Connect (upgrade)</text>

    <!-- Register websocket -->
    <line x1="280" y1="40" x2="435" y2="40" stroke="#60A5FA" stroke-width="2" marker-end="url(#arrowRight)"/>
    <text x="357" y="32" fill="#93C5FD" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">register(websocket)</text>

    <!-- Connection accepted (dashed return) -->
    <line x1="445" y1="80" x2="140" y2="80" stroke="#34D399" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrowRightDashed)"/>
    <text x="292" y="72" fill="#6EE7B7" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">Connection accepted</text>
  </g>

  <!-- Note: Event created -->
  <g transform="translate(680, 225)">
    <rect x="0" y="0" width="140" height="35" rx="4" fill="#8B5CF6" fill-opacity="0.2" stroke="#8B5CF6" stroke-width="1"/>
    <text x="70" y="14" fill="#C4B5FD" font-family="system-ui, sans-serif" font-size="10" font-style="italic" text-anchor="middle">Event created</text>
    <text x="70" y="28" fill="#C4B5FD" font-family="system-ui, sans-serif" font-size="10" font-style="italic" text-anchor="middle">from batch</text>
  </g>

  <!-- Event Flow -->
  <g transform="translate(0, 280)">
    <!-- PUBLISH security_events -->
    <line x1="770" y1="0" x2="625" y2="0" stroke="#A78BFA" stroke-width="2" marker-end="url(#arrowLeft)"/>
    <text x="697" y="-8" fill="#C4B5FD" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">PUBLISH security_events {...}</text>

    <!-- Message received -->
    <line x1="615" y1="40" x2="455" y2="40" stroke="#F87171" stroke-width="2" marker-end="url(#arrowLeft)"/>
    <text x="535" y="32" fill="#FCA5A5" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">Message received</text>

    <!-- send_text(json) -->
    <line x1="445" y1="80" x2="290" y2="80" stroke="#FBBF24" stroke-width="2" marker-end="url(#arrowLeft)"/>
    <text x="367" y="72" fill="#FCD34D" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">send_text(json)</text>

    <!-- Event to client -->
    <line x1="280" y1="120" x2="140" y2="120" stroke="#60A5FA" stroke-width="2" marker-end="url(#arrowLeft)"/>
    <rect x="145" y="128" width="130" height="25" rx="3" fill="#3B82F6" fill-opacity="0.2"/>
    <text x="210" y="145" fill="#93C5FD" font-family="monospace" font-size="9" text-anchor="middle">{"type": "event", ...}</text>
  </g>

  <!-- Note: Dashboard updates -->
  <g transform="translate(50, 440)">
    <rect x="0" y="0" width="130" height="30" rx="4" fill="#3B82F6" fill-opacity="0.2" stroke="#3B82F6" stroke-width="1"/>
    <text x="65" y="20" fill="#93C5FD" font-family="system-ui, sans-serif" font-size="10" font-style="italic" text-anchor="middle">Dashboard updates</text>
  </g>

  <!-- Disconnect Phase -->
  <g transform="translate(0, 490)">
    <!-- Disconnect -->
    <line x1="130" y1="0" x2="270" y2="0" stroke="#60A5FA" stroke-width="2" marker-end="url(#arrowRight)"/>
    <text x="200" y="-8" fill="#93C5FD" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">Disconnect</text>

    <!-- Unregister websocket -->
    <line x1="280" y1="40" x2="435" y2="40" stroke="#60A5FA" stroke-width="2" marker-end="url(#arrowRight)"/>
    <text x="357" y="32" fill="#93C5FD" font-family="system-ui, sans-serif" font-size="11" text-anchor="middle">unregister(websocket)</text>
  </g>

  <!-- Legend -->
  <g transform="translate(50, 565)">
    <rect x="0" y="-12" width="750" height="30" rx="4" fill="rgba(255,255,255,0.05)"/>
    <line x1="20" y1="3" x2="50" y2="3" stroke="#60A5FA" stroke-width="2"/>
    <text x="60" y="7" fill="#9CA3AF" font-family="system-ui, sans-serif" font-size="10">Request</text>
    <line x1="130" y1="3" x2="160" y2="3" stroke="#34D399" stroke-width="2" stroke-dasharray="6,3"/>
    <text x="170" y="7" fill="#9CA3AF" font-family="system-ui, sans-serif" font-size="10">Response</text>
    <line x1="250" y1="3" x2="280" y2="3" stroke="#A78BFA" stroke-width="2"/>
    <text x="290" y="7" fill="#9CA3AF" font-family="system-ui, sans-serif" font-size="10">Publish</text>
    <line x1="360" y1="3" x2="390" y2="3" stroke="#F87171" stroke-width="2"/>
    <text x="400" y="7" fill="#9CA3AF" font-family="system-ui, sans-serif" font-size="10">Subscribe</text>
    <line x1="480" y1="3" x2="510" y2="3" stroke="#FBBF24" stroke-width="2"/>
    <text x="520" y="7" fill="#9CA3AF" font-family="system-ui, sans-serif" font-size="10">Broadcast</text>
  </g>
</svg>
