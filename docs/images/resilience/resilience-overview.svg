<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700" width="900" height="700">
  <defs>
    <linearGradient id="greenGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="amberGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="redGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2563EB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="purpleGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#A855F7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#9333EA;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grayGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4B5563;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#374151;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000" flood-opacity="0.3"/>
    </filter>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6B7280"/>
    </marker>
    <marker id="arrowheadGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
    </marker>
    <marker id="arrowheadRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="700" fill="#111827"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="20" font-weight="bold" fill="#F9FAFB">Resilience Architecture Overview</text>

  <!-- Layer 1: Incoming Request -->
  <g transform="translate(350, 55)">
    <rect x="0" y="0" width="200" height="50" rx="8" fill="url(#blueGradient)" filter="url(#shadow)"/>
    <text x="100" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="white">Incoming Request</text>
    <text x="100" y="38" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#BFDBFE">Service Call</text>
  </g>

  <!-- Arrow from Request to Circuit Breaker -->
  <line x1="450" y1="105" x2="450" y2="135" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Layer 2: Circuit Breaker Layer -->
  <g transform="translate(100, 145)">
    <rect x="0" y="0" width="700" height="140" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="350" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="14" font-weight="600" fill="#9CA3AF">Circuit Breaker Layer</text>

    <!-- Circuit State Decision -->
    <g transform="translate(285, 40)">
      <polygon points="65,0 130,40 65,80 0,40" fill="url(#grayGradient)" filter="url(#shadow)"/>
      <text x="65" y="36" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Circuit</text>
      <text x="65" y="50" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">State?</text>
    </g>

    <!-- CLOSED State -->
    <g transform="translate(30, 55)">
      <rect x="0" y="0" width="120" height="55" rx="6" fill="url(#greenGradient)" filter="url(#shadow)"/>
      <text x="60" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">CLOSED</text>
      <text x="60" y="40" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#D1FAE5">Normal Operation</text>
    </g>

    <!-- OPEN State -->
    <g transform="translate(550, 55)">
      <rect x="0" y="0" width="120" height="55" rx="6" fill="url(#redGradient)" filter="url(#shadow)"/>
      <text x="60" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">OPEN</text>
      <text x="60" y="40" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#FEE2E2">Fast Fail</text>
    </g>

    <!-- HALF_OPEN State -->
    <g transform="translate(290, 90)">
      <rect x="0" y="0" width="120" height="40" rx="6" fill="url(#amberGradient)" filter="url(#shadow)"/>
      <text x="60" y="17" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#1F2937">HALF_OPEN</text>
      <text x="60" y="32" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#451A03">Test Recovery</text>
    </g>

    <!-- Lines from decision to states -->
    <line x1="285" y1="80" x2="150" y2="82" stroke="#10B981" stroke-width="2"/>
    <line x1="415" y1="80" x2="550" y2="82" stroke="#EF4444" stroke-width="2"/>
    <text x="200" y="72" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#10B981">Closed</text>
    <text x="480" y="72" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#EF4444">Open</text>
    <text x="350" y="92" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#F59E0B">Half-Open</text>
  </g>

  <!-- Arrow from Circuit Breaker to Retry Layer -->
  <line x1="450" y1="285" x2="450" y2="315" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="710" y1="225" x2="780" y2="225" stroke="#EF4444" stroke-width="2"/>
  <line x1="780" y1="225" x2="780" y2="520" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowheadRed)"/>

  <!-- Layer 3: Retry Layer -->
  <g transform="translate(100, 325)">
    <rect x="0" y="0" width="700" height="120" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="350" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="14" font-weight="600" fill="#9CA3AF">Retry Layer</text>

    <!-- Retry Decision -->
    <g transform="translate(70, 35)">
      <polygon points="55,0 110,35 55,70 0,35" fill="url(#grayGradient)" filter="url(#shadow)"/>
      <text x="55" y="32" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Retry</text>
      <text x="55" y="45" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Attempt?</text>
    </g>

    <!-- Exponential Backoff -->
    <g transform="translate(250, 40)">
      <rect x="0" y="0" width="130" height="55" rx="6" fill="url(#blueGradient)" filter="url(#shadow)"/>
      <text x="65" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Exponential</text>
      <text x="65" y="40" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Backoff</text>
    </g>

    <!-- Execute Operation -->
    <g transform="translate(450, 40)">
      <rect x="0" y="0" width="130" height="55" rx="6" fill="url(#blueGradient)" filter="url(#shadow)"/>
      <text x="65" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Execute</text>
      <text x="65" y="40" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Operation</text>
    </g>

    <!-- Arrows in retry layer -->
    <line x1="180" y1="70" x2="250" y2="70" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="380" y1="70" x2="450" y2="70" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="205" y="62" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#9CA3AF">Yes</text>

    <!-- Max Retries arrow to DLQ -->
    <line x1="125" y1="105" x2="125" y2="150" stroke="#A855F7" stroke-width="2"/>
    <text x="70" y="115" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#A855F7">Max Retries</text>
  </g>

  <!-- Arrow from Retry to Outcome -->
  <line x1="515" y1="420" x2="515" y2="455" stroke="#6B7280" stroke-width="2"/>

  <!-- Layer 4: Outcome Handling -->
  <g transform="translate(100, 465)">
    <rect x="0" y="0" width="550" height="100" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="275" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="14" font-weight="600" fill="#9CA3AF">Outcome Handling</text>

    <!-- Success -->
    <g transform="translate(30, 35)">
      <rect x="0" y="0" width="140" height="50" rx="6" fill="url(#greenGradient)" filter="url(#shadow)"/>
      <text x="70" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Success</text>
      <text x="70" y="40" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#D1FAE5">Reset Counters</text>
    </g>

    <!-- Failure -->
    <g transform="translate(205, 35)">
      <rect x="0" y="0" width="140" height="50" rx="6" fill="url(#redGradient)" filter="url(#shadow)"/>
      <text x="70" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Failure</text>
      <text x="70" y="40" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#FEE2E2">Increment Counter</text>
    </g>

    <!-- Dead Letter Queue -->
    <g transform="translate(380, 35)">
      <rect x="0" y="0" width="140" height="50" rx="6" fill="url(#purpleGradient)" filter="url(#shadow)"/>
      <text x="70" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="white">Dead Letter</text>
      <text x="70" y="40" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#E9D5FF">Queue</text>
    </g>

    <!-- Arrow from Execute to outcomes -->
    <line x1="415" y1="-10" x2="415" y2="35" stroke="#6B7280" stroke-width="2"/>
    <line x1="415" y1="10" x2="100" y2="10" stroke="#10B981" stroke-width="2"/>
    <line x1="100" y1="10" x2="100" y2="35" stroke="#10B981" stroke-width="2" marker-end="url(#arrowheadGreen)"/>
    <line x1="415" y1="10" x2="275" y2="10" stroke="#EF4444" stroke-width="2"/>
    <line x1="275" y1="10" x2="275" y2="35" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowheadRed)"/>
    <text x="165" y="5" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#10B981">OK</text>
    <text x="335" y="5" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#EF4444">Error</text>

    <!-- DLQ from max retries -->
    <line x1="225" y1="-10" x2="450" y2="35" stroke="#A855F7" stroke-width="2" stroke-dasharray="4"/>
  </g>

  <!-- Layer 5: Recovery Services -->
  <g transform="translate(680, 465)">
    <rect x="0" y="0" width="180" height="100" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="90" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="14" font-weight="600" fill="#9CA3AF">Recovery Services</text>

    <!-- Health Monitor -->
    <g transform="translate(20, 35)">
      <rect x="0" y="0" width="60" height="50" rx="6" fill="url(#blueGradient)" filter="url(#shadow)"/>
      <text x="30" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="600" fill="white">Health</text>
      <text x="30" y="36" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="600" fill="white">Monitor</text>
    </g>

    <!-- Auto Restart -->
    <g transform="translate(100, 35)">
      <rect x="0" y="0" width="60" height="50" rx="6" fill="url(#greenGradient)" filter="url(#shadow)"/>
      <text x="30" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="600" fill="white">Auto</text>
      <text x="30" y="36" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" font-weight="600" fill="white">Restart</text>
    </g>

    <!-- Circular arrows between health monitor and auto restart -->
    <path d="M80 55 Q90 45 100 55" fill="none" stroke="#6B7280" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <path d="M100 65 Q90 75 80 65" fill="none" stroke="#6B7280" stroke-width="1.5" marker-end="url(#arrowhead)"/>
    <text x="82" y="42" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#9CA3AF">Unhealthy</text>
    <text x="82" y="82" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#9CA3AF">Restart</text>
  </g>

  <!-- Feedback arrows -->
  <!-- Failure to OPEN -->
  <path d="M375 550 Q320 580 320 600 Q320 620 710 620 Q800 620 800 300 Q800 200 710 200" fill="none" stroke="#EF4444" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowheadRed)"/>
  <text x="540" y="635" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#EF4444">Threshold Met</text>

  <!-- Success to CLOSED -->
  <path d="M170 550 Q100 580 100 620 Q100 650 50 650 Q20 650 20 180 Q20 160 130 180" fill="none" stroke="#10B981" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowheadGreen)"/>
  <text x="40" y="420" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#10B981">Reset</text>

  <!-- Legend -->
  <g transform="translate(30, 615)">
    <text x="0" y="0" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#9CA3AF">Legend:</text>
    <rect x="0" y="10" width="16" height="16" rx="3" fill="url(#greenGradient)"/>
    <text x="22" y="22" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Healthy/Success</text>
    <rect x="110" y="10" width="16" height="16" rx="3" fill="url(#amberGradient)"/>
    <text x="132" y="22" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Warning/Testing</text>
    <rect x="225" y="10" width="16" height="16" rx="3" fill="url(#redGradient)"/>
    <text x="247" y="22" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Error/Failure</text>
    <rect x="330" y="10" width="16" height="16" rx="3" fill="url(#purpleGradient)"/>
    <text x="352" y="22" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Dead Letter Queue</text>
    <rect x="455" y="10" width="16" height="16" rx="3" fill="url(#blueGradient)"/>
    <text x="477" y="22" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Processing/Services</text>
  </g>
</svg>
