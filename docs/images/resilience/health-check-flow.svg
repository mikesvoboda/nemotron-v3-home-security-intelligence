<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550" width="900" height="550">
  <defs>
    <linearGradient id="greenGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="amberGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="redGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2563EB;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grayGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4B5563;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#374151;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="purpleGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="4" flood-color="#000" flood-opacity="0.4"/>
    </filter>
    <marker id="arrowGray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6B7280"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444"/>
    </marker>
    <marker id="arrowAmber" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#F59E0B"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="550" fill="#111827"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="20" font-weight="bold" fill="#F9FAFB">Service Health Monitoring Flow</text>

  <!-- Monitor Section -->
  <g transform="translate(30, 60)">
    <rect x="0" y="0" width="170" height="80" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="85" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="#9CA3AF">ServiceHealthMonitor</text>

    <rect x="15" y="35" width="140" height="35" rx="6" fill="url(#grayGradient)" filter="url(#shadow)"/>
    <text x="85" y="52" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Health Check Loop</text>
    <text x="85" y="65" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#D1D5DB">Every 15s</text>
  </g>

  <!-- Arrows to Monitored Services -->
  <line x1="200" y1="80" x2="280" y2="80" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowGray)"/>
  <line x1="200" y1="100" x2="280" y2="125" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowGray)"/>
  <line x1="200" y1="120" x2="280" y2="170" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowGray)"/>

  <!-- Monitored Services Section -->
  <g transform="translate(290, 45)">
    <rect x="0" y="0" width="180" height="160" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="90" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="#9CA3AF">Monitored Services</text>

    <rect x="15" y="35" width="150" height="35" rx="6" fill="url(#blueGradient)" filter="url(#shadow)"/>
    <text x="90" y="52" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">RT-DETRv2</text>
    <text x="90" y="65" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#BFDBFE">GET /health</text>

    <rect x="15" y="78" width="150" height="35" rx="6" fill="url(#blueGradient)" filter="url(#shadow)"/>
    <text x="90" y="95" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Nemotron</text>
    <text x="90" y="108" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#BFDBFE">GET /health</text>

    <rect x="15" y="121" width="150" height="35" rx="6" fill="url(#purpleGradient)" filter="url(#shadow)"/>
    <text x="90" y="138" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Redis</text>
    <text x="90" y="151" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#DDD6FE">PING</text>
  </g>

  <!-- Arrows to Service States -->
  <line x1="470" y1="100" x2="530" y2="70" stroke="#10B981" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <line x1="470" y1="130" x2="530" y2="130" stroke="#F59E0B" stroke-width="2" marker-end="url(#arrowAmber)"/>
  <text x="510" y="62" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#10B981">OK</text>
  <text x="510" y="122" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#F59E0B">Fail</text>

  <!-- Service States Section -->
  <g transform="translate(540, 45)">
    <rect x="0" y="0" width="160" height="200" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="80" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="#9CA3AF">Service States</text>

    <rect x="15" y="35" width="130" height="35" rx="6" fill="url(#greenGradient)" filter="url(#shadow)"/>
    <text x="80" y="50" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">healthy</text>
    <text x="80" y="63" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#D1FAE5">Normal operation</text>

    <rect x="15" y="78" width="130" height="35" rx="6" fill="url(#amberGradient)" filter="url(#shadow)"/>
    <text x="80" y="93" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="#1F2937">unhealthy</text>
    <text x="80" y="106" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#451A03">Health check failed</text>

    <rect x="15" y="121" width="130" height="35" rx="6" fill="url(#blueGradient)" filter="url(#shadow)"/>
    <text x="80" y="136" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">restarting</text>
    <text x="80" y="149" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#BFDBFE">Restart in progress</text>

    <rect x="15" y="164" width="130" height="35" rx="6" fill="url(#redGradient)" filter="url(#shadow)"/>
    <text x="80" y="179" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">failed</text>
    <text x="80" y="192" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#FEE2E2">Max retries exceeded</text>
  </g>

  <!-- Arrows to Recovery Actions -->
  <line x1="620" y1="135" x2="620" y2="290" stroke="#F59E0B" stroke-width="2" marker-end="url(#arrowAmber)"/>

  <!-- Recovery Actions Section -->
  <g transform="translate(540, 300)">
    <rect x="0" y="0" width="320" height="130" rx="10" fill="#1F2937" stroke="#374151" stroke-width="2"/>
    <text x="160" y="22" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="12" font-weight="600" fill="#9CA3AF">Recovery Actions</text>

    <rect x="15" y="40" width="90" height="75" rx="6" fill="url(#amberGradient)" filter="url(#shadow)"/>
    <text x="60" y="62" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="#1F2937">Exponential</text>
    <text x="60" y="78" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="#1F2937">Backoff</text>
    <text x="60" y="100" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#451A03">5s * 2^n</text>

    <rect x="115" y="40" width="90" height="75" rx="6" fill="url(#blueGradient)" filter="url(#shadow)"/>
    <text x="160" y="62" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Restart</text>
    <text x="160" y="78" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Service</text>
    <text x="160" y="100" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#BFDBFE">docker restart</text>

    <rect x="215" y="40" width="90" height="75" rx="6" fill="url(#purpleGradient)" filter="url(#shadow)"/>
    <text x="260" y="62" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">WebSocket</text>
    <text x="260" y="78" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" font-weight="600" fill="white">Broadcast</text>
    <text x="260" y="100" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#DDD6FE">Status update</text>

    <!-- Internal arrows -->
    <line x1="105" y1="77" x2="115" y2="77" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowGray)"/>
    <line x1="205" y1="77" x2="215" y2="77" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowGray)"/>
  </g>

  <!-- Recovery feedback loops -->
  <path d="M700 160 Q740 160 740 270 Q740 350 660 365" fill="none" stroke="#10B981" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <text x="750" y="220" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#10B981">Success</text>

  <path d="M700 175 Q760 175 760 270 Q760 380 740 380 Q700 380 700 200" fill="none" stroke="#3B82F6" stroke-width="2" marker-end="url(#arrowGray)"/>
  <text x="770" y="285" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#3B82F6">Fail</text>

  <path d="M700 190 Q780 190 780 450 Q780 480 650 480 Q620 480 620 245" fill="none" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <text x="790" y="380" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#EF4444">Max</text>
  <text x="790" y="392" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#EF4444">Retries</text>

  <!-- Broadcast to states -->
  <path d="M860 385 Q870 200 700 80" fill="none" stroke="#8B5CF6" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowGray)"/>
  <path d="M860 385 Q870 240 700 130" fill="none" stroke="#8B5CF6" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowGray)"/>
  <path d="M860 385 Q870 360 700 210" fill="none" stroke="#8B5CF6" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrowGray)"/>

  <!-- Legend -->
  <g transform="translate(30, 505)">
    <text x="0" y="0" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#9CA3AF">Legend:</text>
    <rect x="60" y="-12" width="16" height="16" rx="3" fill="url(#greenGradient)"/>
    <text x="82" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Healthy</text>
    <rect x="140" y="-12" width="16" height="16" rx="3" fill="url(#amberGradient)"/>
    <text x="162" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Unhealthy/Backoff</text>
    <rect x="270" y="-12" width="16" height="16" rx="3" fill="url(#blueGradient)"/>
    <text x="292" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Restarting</text>
    <rect x="370" y="-12" width="16" height="16" rx="3" fill="url(#redGradient)"/>
    <text x="392" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Failed</text>
    <rect x="450" y="-12" width="16" height="16" rx="3" fill="url(#purpleGradient)"/>
    <text x="472" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Broadcast</text>
  </g>
</svg>
