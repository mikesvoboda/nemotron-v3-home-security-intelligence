<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 500" width="700" height="500">
  <defs>
    <linearGradient id="greenGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="amberGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="redGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
    </linearGradient>
    <filter id="glow-green" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="glow-amber" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="glow-red" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="4" flood-color="#000" flood-opacity="0.4"/>
    </filter>
    <marker id="arrowGray" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#6B7280"/>
    </marker>
    <marker id="arrowRed" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#EF4444"/>
    </marker>
    <marker id="arrowAmber" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#F59E0B"/>
    </marker>
    <marker id="arrowGreen" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#10B981"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="500" fill="#111827"/>

  <!-- Subtle grid pattern -->
  <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#1F2937" stroke-width="0.5"/>
  </pattern>
  <rect width="700" height="500" fill="url(#grid)"/>

  <!-- Title -->
  <text x="350" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="20" font-weight="bold" fill="#F9FAFB">Circuit Breaker State Machine</text>

  <!-- Initial state indicator -->
  <circle cx="100" cy="160" r="8" fill="#4B5563"/>
  <circle cx="100" cy="160" r="4" fill="#9CA3AF"/>
  <line x1="108" y1="160" x2="150" y2="160" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowGray)"/>
  <text x="115" y="150" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Initial State</text>

  <!-- CLOSED State (Green) -->
  <g transform="translate(165, 100)">
    <rect x="0" y="0" width="180" height="120" rx="20" fill="url(#greenGradient)" filter="url(#shadow)"/>
    <rect x="0" y="0" width="180" height="120" rx="20" fill="none" stroke="#34D399" stroke-width="2" filter="url(#glow-green)"/>
    <text x="90" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="bold" fill="white">CLOSED</text>
    <line x1="30" y1="48" x2="150" y2="48" stroke="#34D399" stroke-width="1"/>
    <text x="90" y="68" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#D1FAE5">Normal Operation</text>
    <text x="90" y="85" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#A7F3D0">Calls pass through</text>
    <text x="90" y="100" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#A7F3D0">Track failures</text>
  </g>

  <!-- OPEN State (Red) -->
  <g transform="translate(430, 100)">
    <rect x="0" y="0" width="180" height="120" rx="20" fill="url(#redGradient)" filter="url(#shadow)"/>
    <rect x="0" y="0" width="180" height="120" rx="20" fill="none" stroke="#F87171" stroke-width="2" filter="url(#glow-red)"/>
    <text x="90" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="bold" fill="white">OPEN</text>
    <line x1="30" y1="48" x2="150" y2="48" stroke="#F87171" stroke-width="1"/>
    <text x="90" y="68" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#FEE2E2">Circuit Tripped</text>
    <text x="90" y="85" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#FECACA">Calls rejected immediately</text>
    <text x="90" y="100" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#FECACA">CircuitBreakerError raised</text>
  </g>

  <!-- HALF_OPEN State (Amber) -->
  <g transform="translate(297, 320)">
    <rect x="0" y="0" width="180" height="120" rx="20" fill="url(#amberGradient)" filter="url(#shadow)"/>
    <rect x="0" y="0" width="180" height="120" rx="20" fill="none" stroke="#FBBF24" stroke-width="2" filter="url(#glow-amber)"/>
    <text x="90" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="16" font-weight="bold" fill="#1F2937">HALF_OPEN</text>
    <line x1="30" y1="48" x2="150" y2="48" stroke="#92400E" stroke-width="1"/>
    <text x="90" y="68" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="11" fill="#451A03">Recovery Testing</text>
    <text x="90" y="85" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#78350F">Limited calls allowed</text>
    <text x="90" y="100" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#78350F">Track successes</text>
  </g>

  <!-- Transition: CLOSED -> OPEN -->
  <path d="M 345 160 Q 395 120 430 160" fill="none" stroke="#EF4444" stroke-width="3" marker-end="url(#arrowRed)"/>
  <g transform="translate(350, 90)">
    <rect x="0" y="0" width="110" height="35" rx="6" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="55" y="15" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#EF4444">failures &gt;= threshold</text>
    <text x="55" y="28" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#9CA3AF">(default: 5)</text>
  </g>

  <!-- Transition: OPEN -> HALF_OPEN -->
  <path d="M 520 220 Q 520 280 477 320" fill="none" stroke="#F59E0B" stroke-width="3" marker-end="url(#arrowAmber)"/>
  <g transform="translate(505, 250)">
    <rect x="0" y="0" width="120" height="35" rx="6" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="60" y="15" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#F59E0B">recovery_timeout elapsed</text>
    <text x="60" y="28" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#9CA3AF">(default: 30s)</text>
  </g>

  <!-- Transition: HALF_OPEN -> CLOSED -->
  <path d="M 297 380 Q 200 380 200 220" fill="none" stroke="#10B981" stroke-width="3" marker-end="url(#arrowGreen)"/>
  <g transform="translate(105, 280)">
    <rect x="0" y="0" width="125" height="35" rx="6" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="62" y="15" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#10B981">success_threshold met</text>
    <text x="62" y="28" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#9CA3AF">(default: 2 successes)</text>
  </g>

  <!-- Transition: HALF_OPEN -> OPEN -->
  <path d="M 477 380 Q 570 380 570 220" fill="none" stroke="#EF4444" stroke-width="3" marker-end="url(#arrowRed)"/>
  <g transform="translate(555, 280)">
    <rect x="0" y="0" width="85" height="30" rx="6" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="42" y="19" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#EF4444">any failure</text>
  </g>

  <!-- Legend -->
  <g transform="translate(30, 455)">
    <text x="0" y="0" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#9CA3AF">Legend:</text>
    <rect x="60" y="-12" width="18" height="18" rx="4" fill="url(#greenGradient)"/>
    <text x="85" y="2" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Healthy / Normal</text>
    <rect x="185" y="-12" width="18" height="18" rx="4" fill="url(#amberGradient)"/>
    <text x="210" y="2" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Testing / Recovery</text>
    <rect x="330" y="-12" width="18" height="18" rx="4" fill="url(#redGradient)"/>
    <text x="355" y="2" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Tripped / Blocking</text>
    <circle cx="455" cy="-3" r="6" fill="#4B5563" stroke="#9CA3AF" stroke-width="1"/>
    <text x="468" y="2" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Initial State</text>
  </g>
</svg>
