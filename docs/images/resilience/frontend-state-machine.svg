<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 400" width="700" height="400">
  <defs>
    <linearGradient id="greenGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#10B981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="amberGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="redGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="4" flood-color="#000" flood-opacity="0.4"/>
    </filter>
    <filter id="glow-green" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="glow-amber" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="glow-red" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <marker id="arrowGray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6B7280"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
    </marker>
    <marker id="arrowAmber" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#F59E0B"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="700" height="400" fill="#111827"/>

  <!-- Subtle grid pattern -->
  <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#1F2937" stroke-width="0.5"/>
  </pattern>
  <rect width="700" height="400" fill="url(#grid)"/>

  <!-- Title -->
  <text x="350" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="20" font-weight="bold" fill="#F9FAFB">Frontend Circuit Breaker State Machine</text>

  <!-- Initial state indicator -->
  <circle cx="60" cy="130" r="8" fill="#4B5563"/>
  <circle cx="60" cy="130" r="4" fill="#9CA3AF"/>
  <line x1="68" y1="130" x2="110" y2="130" stroke="#6B7280" stroke-width="2" marker-end="url(#arrowGray)"/>
  <text x="75" y="120" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#9CA3AF">connect()</text>

  <!-- Connected State (Green) -->
  <g transform="translate(120, 75)">
    <rect x="0" y="0" width="170" height="110" rx="16" fill="url(#greenGradient)" filter="url(#shadow)"/>
    <rect x="0" y="0" width="170" height="110" rx="16" fill="none" stroke="#34D399" stroke-width="2" filter="url(#glow-green)"/>
    <text x="85" y="28" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="14" font-weight="bold" fill="white">Connected</text>
    <line x1="20" y1="38" x2="150" y2="38" stroke="#34D399" stroke-width="1"/>
    <text x="85" y="58" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#D1FAE5">isConnected = true</text>
    <text x="85" y="75" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#D1FAE5">hasExhaustedRetries = false</text>
    <text x="85" y="92" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#D1FAE5">reconnectAttempts = 0</text>
  </g>

  <!-- Reconnecting State (Amber) -->
  <g transform="translate(380, 75)">
    <rect x="0" y="0" width="170" height="110" rx="16" fill="url(#amberGradient)" filter="url(#shadow)"/>
    <rect x="0" y="0" width="170" height="110" rx="16" fill="none" stroke="#FBBF24" stroke-width="2" filter="url(#glow-amber)"/>
    <text x="85" y="28" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="14" font-weight="bold" fill="#1F2937">Reconnecting</text>
    <line x1="20" y1="38" x2="150" y2="38" stroke="#92400E" stroke-width="1"/>
    <text x="85" y="58" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#451A03">isConnected = false</text>
    <text x="85" y="75" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#451A03">Exponential backoff + jitter</text>
    <text x="85" y="92" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#451A03">reconnectAttempts++</text>
  </g>

  <!-- Exhausted State (Red) -->
  <g transform="translate(250, 250)">
    <rect x="0" y="0" width="200" height="110" rx="16" fill="url(#redGradient)" filter="url(#shadow)"/>
    <rect x="0" y="0" width="200" height="110" rx="16" fill="none" stroke="#F87171" stroke-width="2" filter="url(#glow-red)"/>
    <text x="100" y="28" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="14" font-weight="bold" fill="white">Exhausted</text>
    <line x1="25" y1="38" x2="175" y2="38" stroke="#F87171" stroke-width="1"/>
    <text x="100" y="58" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#FEE2E2">hasExhaustedRetries = true</text>
    <text x="100" y="75" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#FEE2E2">onMaxRetriesExhausted() called</text>
    <text x="100" y="92" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="9" fill="#FEE2E2">No automatic reconnection</text>
  </g>

  <!-- Transition: Connected -> Reconnecting -->
  <path d="M 290 130 Q 335 90 380 130" fill="none" stroke="#F59E0B" stroke-width="3" marker-end="url(#arrowAmber)"/>
  <g transform="translate(310, 65)">
    <rect x="0" y="0" width="70" height="20" rx="4" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="35" y="14" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#F59E0B">onClose event</text>
  </g>

  <!-- Transition: Reconnecting -> Connected -->
  <path d="M 380 165 Q 335 205 290 165" fill="none" stroke="#10B981" stroke-width="3" marker-end="url(#arrowGreen)"/>
  <g transform="translate(310, 190)">
    <rect x="0" y="0" width="70" height="20" rx="4" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="35" y="14" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="8" fill="#10B981">onOpen event</text>
  </g>

  <!-- Transition: Reconnecting -> Reconnecting (self-loop) -->
  <path d="M 550 110 Q 600 80 600 130 Q 600 180 550 155" fill="none" stroke="#F59E0B" stroke-width="2" marker-end="url(#arrowAmber)"/>
  <g transform="translate(590, 115)">
    <rect x="0" y="0" width="85" height="28" rx="4" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="42" y="12" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#F59E0B">attempt &lt;</text>
    <text x="42" y="23" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#F59E0B">maxReconnectAttempts</text>
  </g>

  <!-- Transition: Reconnecting -> Exhausted -->
  <path d="M 465 185 Q 465 220 450 250" fill="none" stroke="#EF4444" stroke-width="3" marker-end="url(#arrowRed)"/>
  <g transform="translate(470, 200)">
    <rect x="0" y="0" width="95" height="28" rx="4" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="47" y="12" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#EF4444">attempt &gt;=</text>
    <text x="47" y="23" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#EF4444">maxReconnectAttempts</text>
  </g>

  <!-- Transition: Exhausted -> Connected (manual) -->
  <path d="M 250 305 Q 150 305 150 185" fill="none" stroke="#10B981" stroke-width="2" stroke-dasharray="6" marker-end="url(#arrowGreen)"/>
  <g transform="translate(80, 250)">
    <rect x="0" y="0" width="90" height="28" rx="4" fill="#1F2937" stroke="#374151" stroke-width="1"/>
    <text x="45" y="12" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#10B981">Manual connect()</text>
    <text x="45" y="23" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="7" fill="#10B981">call</text>
  </g>

  <!-- Legend -->
  <g transform="translate(30, 365)">
    <text x="0" y="0" font-family="system-ui, -apple-system, sans-serif" font-size="11" font-weight="600" fill="#9CA3AF">Legend:</text>
    <rect x="60" y="-12" width="16" height="16" rx="4" fill="url(#greenGradient)"/>
    <text x="82" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Connected</text>
    <rect x="155" y="-12" width="16" height="16" rx="4" fill="url(#amberGradient)"/>
    <text x="177" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Reconnecting</text>
    <rect x="265" y="-12" width="16" height="16" rx="4" fill="url(#redGradient)"/>
    <text x="287" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Exhausted</text>
    <line x1="360" y1="-4" x2="390" y2="-4" stroke="#10B981" stroke-width="2" stroke-dasharray="6"/>
    <text x="397" y="1" font-family="system-ui, -apple-system, sans-serif" font-size="10" fill="#9CA3AF">Manual action</text>
  </g>
</svg>
