<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 650" width="800" height="650">
  <defs>
    <marker id="arrow-d" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
    <marker id="arrow-d-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444"/>
    </marker>
    <marker id="arrow-d-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="650" fill="#FFFFFF"/>

  <!-- Title -->
  <text x="400" y="35" font-family="Inter, system-ui, sans-serif" font-size="20" font-weight="600" fill="#111827" text-anchor="middle">Detection Error Handling Flow</text>
  <text x="400" y="55" font-family="Inter, system-ui, sans-serif" font-size="12" fill="#6B7280" text-anchor="middle">Graceful degradation through validation stages</text>

  <!-- Start: Detection Request -->
  <rect x="300" y="75" width="200" height="45" rx="6" fill="#DBEAFE" stroke="#3B82F6" stroke-width="2"/>
  <text x="400" y="103" font-family="Inter, system-ui, sans-serif" font-size="13" font-weight="500" fill="#1E40AF" text-anchor="middle">Detection Request</text>

  <!-- Arrow -->
  <line x1="400" y1="120" x2="400" y2="150" stroke="#374151" stroke-width="1.5" marker-end="url(#arrow-d)"/>

  <!-- Decision 1: File exists? -->
  <polygon points="400,155 490,200 400,245 310,200" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="400" y="205" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#92400E" text-anchor="middle">File exists?</text>

  <!-- No: Log error -->
  <line x1="490" y1="200" x2="600" y2="200" stroke="#EF4444" stroke-width="1.5" marker-end="url(#arrow-d-red)"/>
  <text x="545" y="190" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#EF4444">No</text>
  <rect x="605" y="177" width="150" height="45" rx="6" fill="#FEE2E2" stroke="#EF4444" stroke-width="1.5"/>
  <text x="680" y="196" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#991B1B" text-anchor="middle">Log error</text>
  <text x="680" y="212" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#991B1B" text-anchor="middle">return []</text>

  <!-- Yes: Continue -->
  <line x1="400" y1="245" x2="400" y2="275" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrow-d-green)"/>
  <text x="415" y="265" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">Yes</text>

  <!-- Decision 2: YOLO26 reachable? -->
  <polygon points="400,280 510,330 400,380 290,330" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="400" y="325" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">YOLO26</text>
  <text x="400" y="340" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">reachable?</text>

  <!-- No: Connection error -->
  <line x1="510" y1="330" x2="600" y2="330" stroke="#EF4444" stroke-width="1.5" marker-end="url(#arrow-d-red)"/>
  <text x="555" y="320" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#EF4444">No</text>
  <rect x="605" y="307" width="150" height="45" rx="6" fill="#FEE2E2" stroke="#EF4444" stroke-width="1.5"/>
  <text x="680" y="326" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#991B1B" text-anchor="middle">Log connection error</text>
  <text x="680" y="342" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#991B1B" text-anchor="middle">return []</text>

  <!-- Yes: Continue -->
  <line x1="400" y1="380" x2="400" y2="410" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrow-d-green)"/>
  <text x="415" y="400" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">Yes</text>

  <!-- Decision 3: Request timeout? -->
  <polygon points="400,415 500,460 400,505 300,460" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="400" y="455" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">Request</text>
  <text x="400" y="470" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">timeout?</text>

  <!-- Yes: Timeout error -->
  <line x1="500" y1="460" x2="600" y2="460" stroke="#EF4444" stroke-width="1.5" marker-end="url(#arrow-d-red)"/>
  <text x="550" y="450" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#EF4444">Yes</text>
  <rect x="605" y="437" width="150" height="45" rx="6" fill="#FEE2E2" stroke="#EF4444" stroke-width="1.5"/>
  <text x="680" y="456" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#991B1B" text-anchor="middle">Log timeout</text>
  <text x="680" y="472" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#991B1B" text-anchor="middle">return []</text>

  <!-- No: Continue (left branch) -->
  <line x1="300" y1="460" x2="200" y2="460" stroke="#10B981" stroke-width="1.5"/>
  <line x1="200" y1="460" x2="200" y2="205" stroke="#10B981" stroke-width="1.5"/>
  <text x="250" y="450" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">No</text>

  <!-- Decision 4: HTTP 200? -->
  <polygon points="200,155 280,200 200,245 120,200" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="200" y="205" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#92400E" text-anchor="middle">HTTP 200?</text>

  <!-- No: HTTP error -->
  <line x1="120" y1="200" x2="45" y2="200" stroke="#EF4444" stroke-width="1.5" marker-end="url(#arrow-d-red)"/>
  <text x="85" y="190" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#EF4444">No</text>
  <rect x="20" y="220" width="110" height="45" rx="6" fill="#FEE2E2" stroke="#EF4444" stroke-width="1.5"/>
  <text x="75" y="239" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#991B1B" text-anchor="middle">Log HTTP error</text>
  <text x="75" y="255" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#991B1B" text-anchor="middle">return []</text>

  <!-- Yes: Continue -->
  <line x1="200" y1="245" x2="200" y2="290" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrow-d-green)"/>
  <text x="215" y="270" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">Yes</text>

  <!-- Decision 5: Valid JSON? -->
  <polygon points="200,295 280,340 200,385 120,340" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="200" y="345" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#92400E" text-anchor="middle">Valid JSON?</text>

  <!-- No: Parse error -->
  <line x1="120" y1="340" x2="45" y2="340" stroke="#EF4444" stroke-width="1.5" marker-end="url(#arrow-d-red)"/>
  <text x="85" y="330" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#EF4444">No</text>
  <rect x="20" y="360" width="110" height="45" rx="6" fill="#FEE2E2" stroke="#EF4444" stroke-width="1.5"/>
  <text x="75" y="379" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#991B1B" text-anchor="middle">Log parse error</text>
  <text x="75" y="395" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#991B1B" text-anchor="middle">return []</text>

  <!-- Yes: Process detections -->
  <line x1="200" y1="385" x2="200" y2="430" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrow-d-green)"/>
  <text x="215" y="410" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">Yes</text>

  <!-- Process detections box -->
  <rect x="130" y="435" width="140" height="40" rx="6" fill="#DBEAFE" stroke="#3B82F6" stroke-width="1.5"/>
  <text x="200" y="460" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#1E40AF" text-anchor="middle">Process Detections</text>

  <!-- Arrow to confidence check -->
  <line x1="200" y1="475" x2="200" y2="510" stroke="#374151" stroke-width="1.5" marker-end="url(#arrow-d)"/>

  <!-- Decision 6: Above confidence threshold? -->
  <polygon points="200,515 300,560 200,605 100,560" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="200" y="555" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#92400E" text-anchor="middle">Above confidence</text>
  <text x="200" y="570" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#92400E" text-anchor="middle">threshold?</text>

  <!-- No: Filter out -->
  <line x1="100" y1="560" x2="45" y2="560" stroke="#6B7280" stroke-width="1.5" marker-end="url(#arrow-d)"/>
  <text x="75" y="550" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#6B7280">No</text>
  <rect x="20" y="530" width="80" height="35" rx="6" fill="#F3F4F6" stroke="#9CA3AF" stroke-width="1.5"/>
  <text x="60" y="552" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#374151" text-anchor="middle">Filter out</text>

  <!-- Yes: Create Detection record -->
  <line x1="300" y1="560" x2="380" y2="560" stroke="#10B981" stroke-width="1.5" marker-end="url(#arrow-d-green)"/>
  <text x="340" y="550" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">Yes</text>
  <rect x="385" y="535" width="160" height="50" rx="6" fill="#D1FAE5" stroke="#10B981" stroke-width="2"/>
  <text x="465" y="557" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#065F46" text-anchor="middle">Create Detection</text>
  <text x="465" y="575" font-family="Inter, system-ui, sans-serif" font-size="12" font-weight="500" fill="#065F46" text-anchor="middle">Record</text>

  <!-- Legend -->
  <rect x="580" y="540" width="180" height="95" rx="6" fill="#FAFAFA" stroke="#E5E7EB" stroke-width="1"/>
  <text x="670" y="558" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="600" fill="#374151" text-anchor="middle">Error Response</text>

  <g font-family="Inter, system-ui, sans-serif" font-size="9">
    <rect x="595" y="568" width="40" height="15" rx="3" fill="#FEE2E2" stroke="#EF4444" stroke-width="1"/>
    <text x="650" y="580" fill="#374151">Error path</text>

    <rect x="595" y="590" width="40" height="15" rx="3" fill="#D1FAE5" stroke="#10B981" stroke-width="1"/>
    <text x="650" y="602" fill="#374151">Success path</text>

    <text x="595" y="625" fill="#6B7280">All errors return empty []</text>
  </g>
</svg>
