<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 550" width="700" height="550">
  <defs>
    <marker id="arr" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
    <marker id="arr-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444"/>
    </marker>
    <marker id="arr-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10B981"/>
    </marker>
    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="700" height="550" fill="#FFFFFF"/>

  <!-- Title -->
  <text x="350" y="35" font-family="Inter, system-ui, sans-serif" font-size="20" font-weight="600" fill="#111827" text-anchor="middle">Fast-Path Decision Flow</text>
  <text x="350" y="55" font-family="Inter, system-ui, sans-serif" font-size="12" fill="#6B7280" text-anchor="middle">Critical detection bypass logic for immediate analysis</text>

  <!-- Start: Detection arrives -->
  <rect x="250" y="80" width="200" height="45" rx="6" fill="#DBEAFE" stroke="#3B82F6" stroke-width="2"/>
  <text x="350" y="108" font-family="Inter, system-ui, sans-serif" font-size="13" font-weight="500" fill="#1E40AF" text-anchor="middle">Detection Arrives</text>

  <!-- Arrow to first decision -->
  <line x1="350" y1="125" x2="350" y2="155" stroke="#374151" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Decision 1: confidence >= 0.90? -->
  <polygon points="350,160 450,210 350,260 250,210" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="350" y="205" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">confidence</text>
  <text x="350" y="220" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">>= 0.90?</text>

  <!-- No branch from decision 1 -->
  <line x1="250" y1="210" x2="120" y2="210" stroke="#6B7280" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="185" y="200" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#6B7280">No</text>

  <!-- Normal batching box (left) -->
  <rect x="30" y="185" width="90" height="50" rx="6" fill="#F3F4F6" stroke="#9CA3AF" stroke-width="1.5"/>
  <text x="75" y="207" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#374151" text-anchor="middle">Normal</text>
  <text x="75" y="222" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#374151" text-anchor="middle">Batching</text>

  <!-- Yes branch from decision 1 -->
  <line x1="350" y1="260" x2="350" y2="290" stroke="#10B981" stroke-width="1.5" marker-end="url(#arr-green)"/>
  <text x="365" y="280" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">Yes</text>

  <!-- Decision 2: object_type in fast_path_types? -->
  <polygon points="350,295 470,350 350,405 230,350" fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
  <text x="350" y="340" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">object_type in</text>
  <text x="350" y="355" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#92400E" text-anchor="middle">fast_path_types?</text>

  <!-- No branch from decision 2 -->
  <line x1="230" y1="350" x2="75" y2="350" stroke="#6B7280" stroke-width="1.5"/>
  <line x1="75" y1="350" x2="75" y2="235" stroke="#6B7280" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="155" y="340" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#6B7280">No</text>

  <!-- Yes branch from decision 2 -->
  <line x1="350" y1="405" x2="350" y2="435" stroke="#EF4444" stroke-width="2" marker-end="url(#arr-red)"/>
  <text x="365" y="425" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#10B981">Yes</text>

  <!-- FAST PATH highlight box -->
  <rect x="250" y="440" width="200" height="45" rx="6" fill="#FEE2E2" stroke="#EF4444" stroke-width="2" filter="url(#glow)"/>
  <text x="350" y="462" font-family="Inter, system-ui, sans-serif" font-size="15" font-weight="700" fill="#991B1B" text-anchor="middle">FAST PATH</text>
  <text x="350" y="478" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#B91C1C" text-anchor="middle">Bypass batch aggregation</text>

  <!-- Right side: Fast path flow -->
  <line x1="450" y1="462" x2="500" y2="462" stroke="#EF4444" stroke-width="1.5" marker-end="url(#arr-red)"/>

  <!-- Immediate LLM analysis -->
  <rect x="505" y="80" width="160" height="45" rx="6" fill="#D1FAE5" stroke="#10B981" stroke-width="1.5"/>
  <text x="585" y="100" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#065F46" text-anchor="middle">Immediate LLM</text>
  <text x="585" y="115" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#065F46" text-anchor="middle">Analysis</text>

  <!-- Create Event -->
  <rect x="505" y="145" width="160" height="45" rx="6" fill="#D1FAE5" stroke="#10B981" stroke-width="1.5"/>
  <text x="585" y="165" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#065F46" text-anchor="middle">Create Event</text>
  <text x="585" y="180" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#059669" text-anchor="middle">is_fast_path=true</text>

  <!-- WebSocket broadcast -->
  <rect x="505" y="210" width="160" height="45" rx="6" fill="#D1FAE5" stroke="#10B981" stroke-width="1.5"/>
  <text x="585" y="237" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#065F46" text-anchor="middle">WebSocket Broadcast</text>

  <!-- Connect fast path box to right flow -->
  <path d="M 585 440 L 585 260" fill="none" stroke="#EF4444" stroke-width="1.5" stroke-dasharray="5,3"/>
  <line x1="585" y1="260" x2="585" y2="258" stroke="#EF4444" stroke-width="1.5" marker-end="url(#arr-red)"/>

  <!-- Arrows between right boxes -->
  <line x1="585" y1="125" x2="585" y2="142" stroke="#10B981" stroke-width="1.5" marker-end="url(#arr-green)"/>
  <line x1="585" y1="190" x2="585" y2="207" stroke="#10B981" stroke-width="1.5" marker-end="url(#arr-green)"/>

  <!-- Normal path continuation -->
  <line x1="75" y1="235" x2="75" y2="430" stroke="#6B7280" stroke-width="1.5"/>

  <!-- Add to batch -->
  <rect x="30" y="430" width="90" height="40" rx="6" fill="#F3F4F6" stroke="#9CA3AF" stroke-width="1.5"/>
  <text x="75" y="454" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="500" fill="#374151" text-anchor="middle">Add to Batch</text>

  <!-- Wait for timeout -->
  <rect x="30" y="490" width="90" height="40" rx="6" fill="#F3F4F6" stroke="#9CA3AF" stroke-width="1.5"/>
  <text x="75" y="507" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#374151" text-anchor="middle">Wait for Batch</text>
  <text x="75" y="520" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#374151" text-anchor="middle">Timeout</text>

  <!-- Normal analysis -->
  <rect x="140" y="490" width="90" height="40" rx="6" fill="#F3F4F6" stroke="#9CA3AF" stroke-width="1.5"/>
  <text x="185" y="507" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#374151" text-anchor="middle">Normal</text>
  <text x="185" y="520" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#374151" text-anchor="middle">Analysis Flow</text>

  <!-- Arrows for normal path -->
  <line x1="75" y1="470" x2="75" y2="487" stroke="#6B7280" stroke-width="1.5" marker-end="url(#arr)"/>
  <line x1="120" y1="510" x2="137" y2="510" stroke="#6B7280" stroke-width="1.5" marker-end="url(#arr)"/>

  <!-- Legend -->
  <rect x="505" y="290" width="160" height="130" rx="6" fill="#FAFAFA" stroke="#E5E7EB" stroke-width="1"/>
  <text x="585" y="310" font-family="Inter, system-ui, sans-serif" font-size="11" font-weight="600" fill="#374151" text-anchor="middle">Fast Path Criteria</text>

  <text x="520" y="335" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#374151">Confidence:</text>
  <text x="620" y="335" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="600" fill="#EF4444">>= 0.90</text>

  <text x="520" y="355" font-family="Inter, system-ui, sans-serif" font-size="10" fill="#374151">Object types:</text>
  <text x="590" y="375" font-family="Inter, system-ui, sans-serif" font-size="10" font-weight="500" fill="#3B82F6" text-anchor="middle">["person"]</text>

  <rect x="515" y="390" width="140" height="25" rx="4" fill="#FEE2E2"/>
  <text x="585" y="407" font-family="Inter, system-ui, sans-serif" font-size="9" fill="#991B1B" text-anchor="middle">Latency: ~3-6 seconds</text>
</svg>
